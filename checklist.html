<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš æˆ¿è½¦ç‰©å“æ¸…å•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            color: white;
            padding: 20px 0;
        }
        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        .sync-status {
            font-size: 0.85em;
            margin-bottom: 10px;
            padding: 5px 15px;
            border-radius: 15px;
            display: inline-block;
        }
        .sync-status.synced {
            background: rgba(67, 233, 123, 0.3);
        }
        .sync-status.syncing {
            background: rgba(255, 193, 7, 0.3);
        }
        .sync-status.error {
            background: rgba(245, 87, 108, 0.3);
        }
        .progress-bar {
            background: rgba(255,255,255,0.3);
            border-radius: 20px;
            height: 20px;
            margin: 15px 0;
            overflow: hidden;
        }
        .progress-fill {
            background: linear-gradient(90deg, #43e97b, #38f9d7);
            height: 100%;
            border-radius: 20px;
            transition: width 0.3s ease;
        }
        .progress-text {
            color: white;
            font-size: 0.9em;
        }
        .category {
            background: white;
            border-radius: 15px;
            margin-bottom: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        .category-header {
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }
        .category-header:hover {
            background: #f8f9fa;
        }
        .category-header h2 {
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .category-count {
            background: #667eea;
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.85em;
        }
        .category-count.complete {
            background: #43e97b;
        }
        .toggle-icon {
            font-size: 1.2em;
            transition: transform 0.3s;
        }
        .category.collapsed .toggle-icon {
            transform: rotate(-90deg);
        }
        .category.collapsed .category-content {
            display: none;
        }
        .category-content {
            padding: 0 20px 15px 20px;
        }
        .subcategory {
            margin-top: 15px;
        }
        .subcategory h3 {
            font-size: 0.9em;
            color: #888;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }
        .item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
            gap: 12px;
        }
        .item:last-child {
            border-bottom: none;
        }
        .item input[type="checkbox"] {
            width: 22px;
            height: 22px;
            cursor: pointer;
            accent-color: #667eea;
        }
        .item label {
            flex: 1;
            cursor: pointer;
            font-size: 0.95em;
        }
        .item.checked label {
            text-decoration: line-through;
            color: #aaa;
        }
        .item .delete-btn {
            background: none;
            border: none;
            color: #ddd;
            cursor: pointer;
            font-size: 1.2em;
            padding: 5px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .item:hover .delete-btn {
            opacity: 1;
        }
        .item .delete-btn:hover {
            color: #f5576c;
        }
        .add-item {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed #ddd;
        }
        .add-item input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #eee;
            border-radius: 10px;
            font-size: 0.9em;
            outline: none;
        }
        .add-item input:focus {
            border-color: #667eea;
        }
        .add-item button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9em;
        }
        .add-item button:hover {
            opacity: 0.9;
        }
        .actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .actions button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9em;
            min-width: 100px;
        }
        .btn-reset {
            background: white;
            color: #667eea;
        }
        .btn-refresh {
            background: rgba(255,255,255,0.2);
            color: white;
        }
        .footer {
            text-align: center;
            color: white;
            padding: 20px;
            opacity: 0.7;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš æˆ¿è½¦ç‰©å“æ¸…å•</h1>
            <div class="sync-status synced" id="syncStatus">â˜ï¸ å·²åŒæ­¥</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text"><span id="checkedCount">0</span> / <span id="totalCount">0</span> å·²å®Œæˆ</div>
        </div>

        <div class="actions">
            <button class="btn-refresh" onclick="loadFromCloud()">ğŸ”„ åˆ·æ–°åŒæ­¥</button>
            <button class="btn-reset" onclick="resetAll()">â†©ï¸ é‡ç½®å‹¾é€‰</button>
        </div>

        <div id="categories"></div>

        <div class="footer">
            â˜ï¸ æ•°æ®è‡ªåŠ¨äº‘ç«¯åŒæ­¥<br>
            ç‚¹å‡»"åˆ·æ–°åŒæ­¥"æŸ¥çœ‹ä»–äººæ›´æ–°<br>
            2026æ˜¥èŠ‚æˆ¿è½¦è¡Œç¨‹é…å¥—æ¸…å•
        </div>
    </div>

    <script>
        // JSONBin é…ç½®
        const JSONBIN_BIN_ID = '6981d89aae596e708f0dd010';
        const JSONBIN_API_KEY = '$2a$10$SpbN3KQaiupVhConl6cF7.lS2XPMR3S5Bnue5PnqCfOe.z/sIE.ES';
        const JSONBIN_URL = `https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`;

        // åˆå§‹æ•°æ®
        const initialData = {
            "ğŸ“ å¨æˆ¿é¡¶éƒ¨åŠæŸœ 1ï¼ˆçƒ¹é¥ªç›¸å…³ï¼‰": {
                "ç‰©å“": [
                    "è°ƒå‘³æ–™å…¨å¥—ï¼ˆç›ã€é…±æ²¹ã€é†‹ã€æ²¹ã€è€å¹²å¦ˆã€èšæ²¹ï¼‰",
                    "ç«é”…åº•æ–™ Ã—3åŒ…",
                    "è˜¸æ–™ï¼ˆèŠéº»é…±ç­‰ï¼‰",
                    "é”…é“²ã€æ±¤å‹ºã€æ¼å‹ºã€é£Ÿå“å¤¹",
                    "æ°´æœåˆ€ + ç §æ¿",
                    "å‰ªåˆ€ã€å¼€ç“¶å™¨"
                ]
            },
            "ğŸ“ å¨æˆ¿é¡¶éƒ¨åŠæŸœ 2ï¼ˆé¤å…·+å¹²è´§ï¼‰": {
                "ç‰©å“": [
                    "ç¢— Ã—6ã€ç›˜å­ Ã—4",
                    "ç­·å­ Ã—6ã€å‹ºå­ Ã—6ã€å‰å­ Ã—4",
                    "å„¿ç«¥é¤å…·ï¼ˆ2å²ï¼‰",
                    "æŒ‚é¢/æ–¹ä¾¿é¢",
                    "ç±³ï¼ˆå°è¢‹ï¼‰",
                    "å…«å®ç²¥ Ã—6ç½",
                    "å¨æˆ¿çº¸å·¾",
                    "æ´—æ´ç²¾ã€æ´—ç¢—å¸ƒã€é’¢ä¸çƒ"
                ]
            },
            "ğŸ“ å®¢å…åŠæŸœ 1ï¼ˆæ´—æ¼±+æŠ¤è‚¤ï¼‰": {
                "ç‰©å“": [
                    "ç‰™åˆ·ç‰™è† Ã—6",
                    "æ¯›å·¾ Ã—6",
                    "æµ´å·¾ Ã—4",
                    "æ´—å‘æ°´ã€æ²æµ´éœ²",
                    "æŠ¤è‚¤å“",
                    "çº¸å·¾ã€å·çº¸",
                    "æ¶ˆæ¯’æ¹¿å·¾"
                ]
            },
            "ğŸ“ å®¢å…åŠæŸœ 2ï¼ˆåŒ»è¯+åº”æ€¥ï¼‰": {
                "ç‰©å“": [
                    "é€€çƒ§è¯ï¼ˆç¾æ—ï¼‰",
                    "æ„Ÿå†’è¯ï¼ˆå¤§äºº+å„¿ç«¥ï¼‰",
                    "æ­¢æ³»è¯ï¼ˆè’™è„±çŸ³æ•£ï¼‰",
                    "ç›Šç”ŸèŒ",
                    "æ™•è½¦è¯",
                    "åˆ›å¯è´´ã€ç¢˜ä¼æ£‰ç‰‡",
                    "ä½“æ¸©è®¡",
                    "è€äººæ—¥å¸¸è¯ç‰©",
                    "å£ç½©",
                    "å…æ´—æ´—æ‰‹æ¶²"
                ]
            },
            "ğŸ“ å®¢å…åŠæŸœ 3ï¼ˆå®å®ä¸“åŒºï¼‰": {
                "ç‰©å“": [
                    "å°¿ä¸æ¹¿ Ã—1åŒ…ï¼ˆå…¶ä½™æ”¾åå¤‡ç®±ï¼‰",
                    "æ¹¿å·¾ Ã—2åŒ…ï¼ˆå…¶ä½™æ”¾åå¤‡ç®±ï¼‰",
                    "å¹²çº¸å·¾",
                    "å¥¶ç“¶/æ°´æ¯",
                    "è¾…é£Ÿç¢—å‹º",
                    "å›´å˜´ Ã—5",
                    "å„¿ç«¥é©¬æ¡¶åœˆ/ä¾¿ç›†"
                ]
            },
            "ğŸ“ å†°ç®±ï¼ˆå¼€ç”µ - ä¿é²œç”¨ï¼‰": {
                "ç‰©å“": [
                    "é¸¡è›‹",
                    "ç‰›å¥¶",
                    "é€Ÿå†»ä¸¸å­ï¼ˆç«é”…ç”¨ï¼‰",
                    "ç«è…¿è‚ ",
                    "æ–°é²œè”¬èœæ°´æœï¼ˆè·¯ä¸Šä¹°ï¼‰"
                ]
            },
            "ğŸ“ å†°ç®±ï¼ˆä¸å¼€ç”µ - å½“å‚¨ç‰©æŸœï¼‰": {
                "ç‰©å“": [
                    "é¢åŒ…/è›‹ç³•",
                    "é¥¼å¹² Ã—å¤šåŒ…",
                    "å­©å­é›¶é£Ÿï¼ˆå°é¦’å¤´ã€æº¶è±†ã€å¥¶é…ªæ£’ï¼‰",
                    "æœæ³¥ã€è‚‰æ³¥",
                    "æ°´æœæ¡/æœå¹²",
                    "æ¦¨èœ/å’¸èœ",
                    "åˆé¤è‚‰ç½å¤´",
                    "ä¿é²œè¢‹ã€ä¿é²œè†œ"
                ]
            },
            "ğŸ“ åå¤‡ç®±": {
                "åºŠå“": [
                    "è¢«å­/ç¡è¢‹",
                    "æ•å¤´",
                    "åºŠå•/éš”è„ç¡è¢‹",
                    "æ¯›æ¯¯"
                ],
                "é”…å…·": [
                    "ç”µç«é”…/å¤šåŠŸèƒ½é”…",
                    "å°ç‚’é”…/å¹³åº•é”…",
                    "å°å¥¶é”…",
                    "ç”µé¥­ç…²"
                ],
                "ç‚‰å…·": [
                    "å¡å¼ç‚‰",
                    "æ°”ç½ Ã—4-6ç½",
                    "é˜²é£æ¿"
                ],
                "å¤§ä»¶": [
                    "è½¦è½½å†°ç®±/ä¿æ¸©ç®±",
                    "çŸ¿æ³‰æ°´ Ã—2ç®±",
                    "æŠ˜å æ¨è½¦ï¼ˆ2å²ï¼‰",
                    "èƒŒå¸¦/è…°å‡³",
                    "é›¨ä¼ Ã—4"
                ],
                "å¤‡ç”¨ç‰©èµ„": [
                    "å°¿ä¸æ¹¿ Ã—2åŒ…ï¼ˆå¤‡ç”¨ï¼‰",
                    "æ¹¿å·¾ Ã—3åŒ…ï¼ˆå¤‡ç”¨ï¼‰",
                    "åƒåœ¾è¢‹ Ã—å¤šå·",
                    "æŠ¹å¸ƒ",
                    "æš–å®å® Ã—20ç‰‡",
                    "å¯†å°ç›’ Ã—è‹¥å¹²"
                ],
                "å„¿ç«¥å®‰å…¨": [
                    "å®‰å…¨åº§æ¤…ï¼ˆ2å²ï¼‰",
                    "å¢é«˜å«ï¼ˆ7å²ï¼‰"
                ]
            },
            "ğŸ“ å°å·¥å…·ç®±ï¼ˆéšæ‰‹å–ç”¨ï¼‰": {
                "è¯ä»¶": [
                    "èº«ä»½è¯ Ã—6",
                    "é©¾ç…§ Ã—2",
                    "è¡Œé©¶è¯",
                    "åŒ»ä¿å¡ Ã—6",
                    "ç°é‡‘ï¼ˆå°‘é‡ï¼‰"
                ],
                "ç”µå­è®¾å¤‡": [
                    "å……ç”µå® Ã—2",
                    "å„ç§å……ç”µçº¿",
                    "æ‰‹ç”µç­’",
                    "æ‰‹æœºæ”¯æ¶"
                ],
                "è½¦è¾†å·¥å…·": [
                    "æ­ç”µçº¿",
                    "ç­ç«å™¨",
                    "ä¸‰è§’è­¦ç¤ºç‰Œ",
                    "åå…‰èƒŒå¿ƒ"
                ],
                "å…¶ä»–": [
                    "ç›¸æœº/å……ç”µå™¨",
                    "è‡ªæ‹æ†"
                ]
            },
            "ğŸ“ åºŠä¸Šï¼ˆç™½å¤©æ”¾ï¼Œç¡å‰æ”¶ï¼‰": {
                "å¨±ä¹": [
                    "iPad + åŠ¨ç”»ç‰‡",
                    "å„¿ç«¥è€³æœº Ã—2",
                    "ç»˜æœ¬ Ã—5",
                    "è´´çº¸ä¹¦/æ¶‚è‰²ä¹¦",
                    "å°ç©å…·"
                ],
                "éšç”¨": [
                    "ä¿æ¸©å£¶ Ã—2ï¼ˆè£…çƒ­æ°´ï¼‰",
                    "ä¿æ¸©æ¯ Ã—4",
                    "å§œèŒ¶åŒ…",
                    "è½¦çª—é®é˜³å¸˜"
                ]
            },
            "ğŸ“ å›ºå®šä½ç½®": {
                "ç‰©å“": [
                    "è½¦è½½çƒ§æ°´å£¶ï¼ˆæ–¹ä¾¿å–ç”¨å¤„ï¼‰"
                ]
            }
        };

        let data = JSON.parse(JSON.stringify(initialData));
        let checkedItems = {};
        let saveTimeout = null;

        // æ›´æ–°åŒæ­¥çŠ¶æ€æ˜¾ç¤º
        function setSyncStatus(status, text) {
            const el = document.getElementById('syncStatus');
            el.className = 'sync-status ' + status;
            el.textContent = text;
        }

        // ä»äº‘ç«¯åŠ è½½
        async function loadFromCloud() {
            setSyncStatus('syncing', 'â³ åŒæ­¥ä¸­...');
            try {
                const response = await fetch(JSONBIN_URL + '/latest', {
                    headers: {
                        'X-Access-Key': JSONBIN_API_KEY
                    }
                });
                const result = await response.json();
                if (result.record && result.record.checkedItems) {
                    checkedItems = result.record.checkedItems;
                    if (result.record.data) {
                        data = result.record.data;
                    }
                }
                setSyncStatus('synced', 'â˜ï¸ å·²åŒæ­¥');
                renderCategories();
            } catch (e) {
                console.error('Load error:', e);
                setSyncStatus('error', 'âŒ åŒæ­¥å¤±è´¥');
            }
        }

        // ä¿å­˜åˆ°äº‘ç«¯
        async function saveToCloud() {
            setSyncStatus('syncing', 'â³ ä¿å­˜ä¸­...');
            try {
                const response = await fetch(JSONBIN_URL, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Access-Key': JSONBIN_API_KEY
                    },
                    body: JSON.stringify({
                        checkedItems: checkedItems,
                        data: data,
                        lastUpdated: new Date().toISOString()
                    })
                });
                if (response.ok) {
                    setSyncStatus('synced', 'â˜ï¸ å·²åŒæ­¥');
                } else {
                    setSyncStatus('error', 'âŒ ä¿å­˜å¤±è´¥');
                }
            } catch (e) {
                console.error('Save error:', e);
                setSyncStatus('error', 'âŒ ä¿å­˜å¤±è´¥');
            }
        }

        // é˜²æŠ–ä¿å­˜
        function debouncedSave() {
            if (saveTimeout) clearTimeout(saveTimeout);
            saveTimeout = setTimeout(saveToCloud, 1000);
        }

        function getItemId(category, subcategory, item) {
            return `${category}-${subcategory}-${item}`.replace(/\s/g, '_');
        }

        function renderCategories() {
            const container = document.getElementById('categories');
            container.innerHTML = '';

            let totalItems = 0;
            let checkedCount = 0;

            for (const [categoryName, subcategories] of Object.entries(data)) {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category';

                let categoryTotal = 0;
                let categoryChecked = 0;

                for (const [subName, items] of Object.entries(subcategories)) {
                    categoryTotal += items.length;
                    items.forEach(item => {
                        const id = getItemId(categoryName, subName, item);
                        if (checkedItems[id]) categoryChecked++;
                    });
                }

                totalItems += categoryTotal;
                checkedCount += categoryChecked;

                const isComplete = categoryChecked === categoryTotal && categoryTotal > 0;

                categoryDiv.innerHTML = `
                    <div class="category-header" onclick="toggleCategory(this)">
                        <h2>${categoryName}</h2>
                        <div style="display:flex;align-items:center;gap:10px;">
                            <span class="category-count ${isComplete ? 'complete' : ''}">${categoryChecked}/${categoryTotal}</span>
                            <span class="toggle-icon">â–¼</span>
                        </div>
                    </div>
                    <div class="category-content">
                        ${Object.entries(subcategories).map(([subName, items]) => `
                            <div class="subcategory">
                                <h3>${subName}</h3>
                                ${items.map(item => {
                                    const id = getItemId(categoryName, subName, item);
                                    const isChecked = checkedItems[id];
                                    return `
                                        <div class="item ${isChecked ? 'checked' : ''}">
                                            <input type="checkbox" id="${id}" ${isChecked ? 'checked' : ''} 
                                                onchange="toggleItem('${categoryName}', '${subName}', '${item.replace(/'/g, "\\'")}')">
                                            <label for="${id}">${item}</label>
                                            <button class="delete-btn" onclick="deleteItem('${categoryName}', '${subName}', '${item.replace(/'/g, "\\'")}')">Ã—</button>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        `).join('')}
                        <div class="add-item">
                            <input type="text" placeholder="æ·»åŠ æ–°ç‰©å“..." id="newItem-${categoryName.replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g, '_')}" 
                                onkeypress="if(event.key==='Enter')addItem('${categoryName}')">
                            <button onclick="addItem('${categoryName}')">æ·»åŠ </button>
                        </div>
                    </div>
                `;

                container.appendChild(categoryDiv);
            }

            document.getElementById('checkedCount').textContent = checkedCount;
            document.getElementById('totalCount').textContent = totalItems;
            const percentage = totalItems > 0 ? (checkedCount / totalItems * 100) : 0;
            document.getElementById('progressFill').style.width = percentage + '%';
        }

        function toggleCategory(header) {
            header.parentElement.classList.toggle('collapsed');
        }

        function toggleItem(category, subcategory, item) {
            const id = getItemId(category, subcategory, item);
            checkedItems[id] = !checkedItems[id];
            renderCategories();
            debouncedSave();
        }

        function deleteItem(category, subcategory, item) {
            if (confirm(`ç¡®å®šåˆ é™¤"${item}"å—ï¼Ÿ`)) {
                const index = data[category][subcategory].indexOf(item);
                if (index > -1) {
                    data[category][subcategory].splice(index, 1);
                    const id = getItemId(category, subcategory, item);
                    delete checkedItems[id];
                    renderCategories();
                    debouncedSave();
                }
            }
        }

        function addItem(category) {
            const inputId = `newItem-${category.replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g, '_')}`;
            const input = document.getElementById(inputId);
            const item = input.value.trim();
            
            if (item) {
                const firstSubcategory = Object.keys(data[category])[0];
                data[category][firstSubcategory].push(item);
                renderCategories();
                debouncedSave();
                
                setTimeout(() => {
                    const newInput = document.getElementById(inputId);
                    if (newInput) newInput.value = '';
                }, 0);
            }
        }

        function resetAll() {
            if (confirm('ç¡®å®šé‡ç½®æ‰€æœ‰å‹¾é€‰çŠ¶æ€å—ï¼Ÿ')) {
                checkedItems = {};
                renderCategories();
                debouncedSave();
            }
        }

        // åˆå§‹åŒ–ï¼šä»äº‘ç«¯åŠ è½½
        loadFromCloud();
    </script>
</body>
</html>